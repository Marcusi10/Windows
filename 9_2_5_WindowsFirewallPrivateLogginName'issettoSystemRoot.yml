- hosts: all
  tasks:
    - name: Ensure 'Windows Firewall: Private: Logging: Name' is set to '%SystemRoot%\System32\logfiles\firewall\privatefw.log'
      win_shell: |
        $firewallProfile = Get-NetFirewallProfile -Name Private
        if ($firewallProfile.LogFilePath -ne '%SystemRoot%\System32\logfiles\firewall\privatefw.log') {
            Set-NetFirewallProfile -Name Private -LogFilePath '%SystemRoot%\System32\logfiles\firewall\privatefw.log'
        }
      register: firewall_logging
      changed_when: firewall_logging.stdout.contains("LogFilePath")
      failed_when: not firewall_logging.stdout.contains("LogFilePath")
      tags:
        - firewall
        - logging
        - security
